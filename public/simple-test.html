<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê°„ë‹¨í•œ API í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; }
        .result { margin: 20px 0; padding: 15px; border-radius: 8px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
    </style>
</head>
<body>
    <h1>ğŸ”§ AICAMP API ê°„ë‹¨ í…ŒìŠ¤íŠ¸</h1>
    
    <div>
        <button class="btn-primary" onclick="testDiagnosisSubmission()">1. ì§„ë‹¨ ì‹ ì²­ í…ŒìŠ¤íŠ¸</button>
        <button class="btn-secondary" onclick="testReportGeneration()">2. ë³´ê³ ì„œ ìƒì„± í…ŒìŠ¤íŠ¸</button>
        <button class="btn-secondary" onclick="testGASConnection()">3. GAS ì—°ê²° í…ŒìŠ¤íŠ¸</button>
    </div>
    
    <div id="results"></div>

    <script>
        let testDiagnosisId = null;

        async function testDiagnosisSubmission() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="result">ğŸ”„ ì§„ë‹¨ ì‹ ì²­ í…ŒìŠ¤íŠ¸ ì¤‘...</div>';

            try {
                // ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ë°ì´í„°
                const testData = {
                    companyName: 'í…ŒìŠ¤íŠ¸íšŒì‚¬',
                    contactName: 'ê¹€í…ŒìŠ¤íŠ¸',
                    contactEmail: 'test@aicamp.club',
                    contactPhone: '010-1234-5678',
                    position: 'CTO',
                    industry: 'IT/ì†Œí”„íŠ¸ì›¨ì–´',
                    employeeCount: '10ëª… ë¯¸ë§Œ',
                    location: 'ì„œìš¸íŠ¹ë³„ì‹œ',
                    privacyConsent: true,
                    responses: {
                        question_1: 4, question_2: 3, question_3: 5, question_4: 4, question_5: 3,
                        question_6: 4, question_7: 5, question_8: 3, question_9: 4, question_10: 3,
                        question_11: 5, question_12: 4, question_13: 3, question_14: 4, question_15: 5,
                        question_16: 3, question_17: 4, question_18: 3, question_19: 5, question_20: 4,
                        question_21: 3, question_22: 4, question_23: 5, question_24: 3, question_25: 4,
                        question_26: 3, question_27: 5, question_28: 4, question_29: 3, question_30: 4,
                        question_31: 5, question_32: 3, question_33: 4, question_34: 3, question_35: 5,
                        question_36: 4, question_37: 3, question_38: 4, question_39: 5, question_40: 3,
                        question_41: 4, question_42: 3, question_43: 5, question_44: 4, question_45: 3
                    },
                    assessmentResponses: {
                        question_1: 4, question_2: 3, question_3: 5, question_4: 4, question_5: 3,
                        question_6: 4, question_7: 5, question_8: 3, question_9: 4, question_10: 3,
                        question_11: 5, question_12: 4, question_13: 3, question_14: 4, question_15: 5,
                        question_16: 3, question_17: 4, question_18: 3, question_19: 5, question_20: 4,
                        question_21: 3, question_22: 4, question_23: 5, question_24: 3, question_25: 4,
                        question_26: 3, question_27: 5, question_28: 4, question_29: 3, question_30: 4,
                        question_31: 5, question_32: 3, question_33: 4, question_34: 3, question_35: 5,
                        question_36: 4, question_37: 3, question_38: 4, question_39: 5, question_40: 3,
                        question_41: 4, question_42: 3, question_43: 5, question_44: 4, question_45: 3
                    }
                };

                console.log('ğŸ“ í…ŒìŠ¤íŠ¸ ë°ì´í„°:', testData);

                const response = await fetch('/api/ai-diagnosis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                console.log('ğŸ“Š ì‘ë‹µ ìƒíƒœ:', response.status);
                
                const result = await response.json();
                console.log('ğŸ“Š ì‘ë‹µ ë°ì´í„°:', result);

                if (result.success) {
                    testDiagnosisId = result.diagnosisId || result.data?.diagnosisId;
                    resultsDiv.innerHTML = `
                        <div class="result success">
                            âœ… ì§„ë‹¨ ì‹ ì²­ ì„±ê³µ!<br>
                            ì§„ë‹¨ ID: <strong>${testDiagnosisId}</strong><br>
                            ì‘ë‹µ ë©”ì‹œì§€: ${result.message}
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="result error">
                            âŒ ì§„ë‹¨ ì‹ ì²­ ì‹¤íŒ¨<br>
                            ì˜¤ë¥˜: ${result.error}<br>
                            ìƒì„¸: ${result.details || 'N/A'}<br>
                            ê²€ì¦: ${JSON.stringify(result.validation || {}, null, 2)}
                        </div>
                    `;
                }

            } catch (error) {
                console.error('í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                resultsDiv.innerHTML = `
                    <div class="result error">
                        âŒ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì˜¤ë¥˜: ${error.message}
                    </div>
                `;
            }
        }

        async function testReportGeneration() {
            if (!testDiagnosisId) {
                alert('ë¨¼ì € ì§„ë‹¨ ì‹ ì²­ í…ŒìŠ¤íŠ¸ë¥¼ ì„±ê³µì‹œì¼œì£¼ì„¸ìš”.');
                return;
            }

            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML += '<div class="result">ğŸ”„ ë³´ê³ ì„œ ìƒì„± í…ŒìŠ¤íŠ¸ ì¤‘...</div>';

            try {
                const response = await fetch(`/api/diagnosis-reports/${testDiagnosisId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                console.log('ğŸ“Š ë³´ê³ ì„œ ì‘ë‹µ ìƒíƒœ:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const result = await response.json();
                console.log('ğŸ“Š ë³´ê³ ì„œ ì‘ë‹µ ë°ì´í„°:', result);

                if (result.success) {
                    resultsDiv.innerHTML += `
                        <div class="result success">
                            âœ… ë³´ê³ ì„œ ìƒì„± ì„±ê³µ!<br>
                            ë³´ê³ ì„œ íƒ€ì…: ${result.reportInfo?.reportType}<br>
                            í˜ì´ì§€ ìˆ˜: ${result.reportInfo?.pages}í˜ì´ì§€<br>
                            HTML ê¸¸ì´: ${result.htmlReport?.length || 0} bytes
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML += `
                        <div class="result error">
                            âŒ ë³´ê³ ì„œ ìƒì„± ì‹¤íŒ¨<br>
                            ì˜¤ë¥˜: ${result.error}
                        </div>
                    `;
                }

            } catch (error) {
                console.error('ë³´ê³ ì„œ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                resultsDiv.innerHTML += `
                    <div class="result error">
                        âŒ ë³´ê³ ì„œ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}
                    </div>
                `;
            }
        }

        async function testGASConnection() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML += '<div class="result">ğŸ”„ GAS ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...</div>';

            try {
                // GAS URL ì§ì ‘ í…ŒìŠ¤íŠ¸
                const gasUrl = 'https://script.google.com/macros/s/AKfycbzO4ykDtUetroPX2TtQ1wkiOVNtd56tUZpPT4EITaLnXeMxTGdIIN8MIEMvOOy8ywTN/exec';
                
                const response = await fetch(gasUrl, {
                    method: 'GET'
                });

                console.log('ğŸ“Š GAS ì‘ë‹µ ìƒíƒœ:', response.status);
                
                const result = await response.json();
                console.log('ğŸ“Š GAS ì‘ë‹µ ë°ì´í„°:', result);

                resultsDiv.innerHTML += `
                    <div class="result success">
                        âœ… GAS ì—°ê²° ì„±ê³µ!<br>
                        ìƒíƒœ: ${result.status}<br>
                        ë©”ì‹œì§€: ${result.message}<br>
                        ë²„ì „: ${result.version}
                    </div>
                `;

            } catch (error) {
                console.error('GAS í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                resultsDiv.innerHTML += `
                    <div class="result error">
                        âŒ GAS ì—°ê²° ì˜¤ë¥˜: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
